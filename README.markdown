trigger.js
==========

&copy; 2010 Jason Frame [ [jason@onehackoranother.com](mailto:jason@onehackoranother.com) / [@jaz303](http://twitter.com/jaz303) ]  
Released under the MIT License.

`trigger.js` provides a centralised client-side event dispatch and filtering mechanism for web apps.

Events
------

In order for your handler functions to be called, they must first be registered. Registration functions come in a number of flavours:

<table>
  <tr>
    <td><b>Event name</b></td>
    <td><code>trigger.observeEvent(eventPattern, callback)</code></td>
    <td>
      Watch for all events whose name matches the supplied pattern.
      Event names are simply namespaced strings using `.` as a separator. Wildcards are supported:
      <ul>
        <li><code>?</code> matches a single component e.g.
          <code>foo.?</code> matches <code>foo.bar</code> and <code>foo.baz</code> but
          does not match <code>foo</code> nor <code>foo.bar.baz</code>.
        </li>
        <li><code>*</code> matches one or more components e.g.
          <code>foo.*</code> matches <code>foo.bar</code>, <code>foo.baz</code> and
          <code>foo.bar.baz</code> does not match <code>foo</code>.
        </li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><b>Source object identity</b></td>
    <td><code>trigger.observeObject(source, callback)</code></td>
    <td>
      Watch for all events generated by a single object.
      Equality test is performed using <code>==</code>
    </td>
  </tr>
  <tr>
    <td><b>Source object type</b></td>
    <td><code>trigger.observeType(sourceType, callback)</code></td>
    <td>
      Watch for all events generated by objects of a given type.
      Type check is performed using <code>instanceof</code>
    </td>
  </tr>
</table>

There's also a generic registration method, `trigger.registerEventHandler(sourceType, source, eventPattern, callback)`, if you need to watch for a combination of the above. Like all `update` events for instances of `FooWidget`. Pass `null` for any conditions you're not interested in.

Once you've registered your handlers (or even before...) you can start firing events about. It's pretty simple:

    trigger.fire(this, 'auction.expired', {auction_id: 123425});
    
The final parameter, user info, is optional and defaults to an empty object. Events are fired synchronously.

Filters
-------

A named filter in `trigger.js` is a chain of event handlers, each of which returns a value. The result of each filter is passed back into the next filter, with the final value ultimately being returned to the  caller. Example:

    trigger.registerFilter('myFilter', function(s) { return s.toUpperCase(); });
    trigger.registerFilter('myFilter', function(s) { return 'hello ' + s; });
    
    // displays "hello JASON"
    alert(trigger.filter('myFilter', 'jason'));

Filter names actually support wildcards too, but that doesn't really sound very useful.

Mixin' In
---------

Calling `trigger.fire(this, 'foo.bar', { ... })` sure gets tiresome. Use `Trigger.mixin(object [, triggerRegistry])` to extend arbitrary objects with their own `fire()`/`filter()` methods, within which the implied event source is `this`. The optional second parameter, `triggerRegistry` allows you to specify an alternate trigger registry if you're not using the default `window.trigger`. FGJ:

    var myArray = [];
    Trigger.mixin(myArray);
    myArray.fire("foo.blam", { ... });
    var result = myArray.filter("send.prefilter", { ... });
    
Other Possibly Interesting Stuff
--------------------------------

When an event handler or filter is registered you get back a `Rule` object. This has `enable()` and `disable()` methods for selectively toggling handlers without affecting other handlers in the chain.

By default, you get a single trigger registry, `window.trigger`. This is just an instance of `Trigger` so just create as many as you need.